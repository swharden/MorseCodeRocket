<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Morse Code Rocket</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body>
    <div class="container my-5">
        <button class="btn btn-primary" onclick="send()">send</button>
    </div>

    <script>
        const audioContext = new (window.AudioContext || window.webkitAudioContext)();

        const wpm = 12;
        const freq = 440;
        const upcoming = [];

        function playTone(duration) {
            console.log('playing');
            const oscillator = audioContext.createOscillator();
            oscillator.frequency.setValueAtTime(freq, audioContext.currentTime);
            oscillator.connect(audioContext.destination);
            oscillator.start();
            oscillator.stop(audioContext.currentTime + duration);
        }

        function stringToMorse(str) {
            const morseCode = {
                'A': '.-', 'B': '-...', 'C': '-.-.', 'D': '-..', 'E': '.',
                'F': '..-.', 'G': '--.', 'H': '....', 'I': '..', 'J': '.---',
                'K': '-.-', 'L': '.-..', 'M': '--', 'N': '-.', 'O': '---',
                'P': '.--.', 'Q': '--.-', 'R': '.-.', 'S': '...', 'T': '-',
                'U': '..-', 'V': '...-', 'W': '.--', 'X': '-..-', 'Y': '-.--',
                'Z': '--..', '1': '.----', '2': '..---', '3': '...--', '4': '....-',
                '5': '.....', '6': '-....', '7': '--...', '8': '---..', '9': '----.',
                '0': '-----', ' ': ' '
            };

            return str.toUpperCase().split('').map(char => morseCode[char] || char);
        }

        function send() {
            const sequence = stringToMorse("aj4vd").join(" ").split("");
            let time = 0;

            const timeUnitSec = 1.2 / wpm;

            sequence.forEach((char, index) => {

                let toneDuration = 0;
                let totalDuration = 0;

                /*
                The length of a dot is 1 time unit.
                A dash is 3 time units.
                The space between symbols (dots and dashes) of the same letter is 1 time unit.
                The space between letters is 3 time units.
                The space between words is 7 time units.
                */

                if (char === '.') {
                    toneDuration = timeUnitSec;
                    totalDuration = toneDuration + timeUnitSec;
                } else if (char === '-') {
                    toneDuration = timeUnitSec * 3;
                    totalDuration = toneDuration + timeUnitSec;
                } else if (char === ' ') {
                    totalDuration = timeUnitSec;
                }

                setTimeout(() => { playTone(toneDuration); }, time);

                time += totalDuration * 1000;

                if (index < sequence.length - 1) {
                    time += timeUnitSec * 1000;
                }
            });
        }

    </script>
</body>

</html>